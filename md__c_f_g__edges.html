<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>GTIRB: CFG-Edges</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">GTIRB
   &#160;<span id="projectnumber">v1.10.4</span>
   </div>
   <div id="projectbrief">GrammaTech Intermediate Representation for Binaries</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">CFG-Edges </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md25">Advice on when to Place ICFG Edges</a><ul><li class="level2"><a href="#autotoc_md26">Undefined/extern functions.</a></li>
<li class="level2"><a href="#autotoc_md27">Fall through edges from call sites.</a><ul><li class="level3"><a href="#autotoc_md28">Non-return functions.</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md29">Edges from returns back to call sites.</a></li>
<li class="level2"><a href="#autotoc_md30">Edges from indirect calls to targets.</a></li>
<li class="level2"><a href="#autotoc_md31">Tail calls.</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="autotoc_md25"></a>
Advice on when to Place ICFG Edges</h1>
<p><a class="anchor" id="advice-on-when-to-place-icfg-edges"></a></p>
<p>It is not always straightforward when to construct ICFG edges. For example, should there be an edge from a function's return to every caller of that function? While GTIRB does not preclude or enforce any particular ICFG connection strategy, we do propose the following suggestions for how to handle many common situations.</p>
<h2><a class="anchor" id="autotoc_md26"></a>
Undefined/extern functions.</h2>
<p><a class="anchor" id="undefinedextern-functions."></a></p>
<p>How to handle edges leaving call instructions to undefined or extern functions? In this case the function is not included in the module and thus is not a possible edge target in the ICFG.</p>
<blockquote class="doxtable">
<p>???? </p>
</blockquote>
<h2><a class="anchor" id="autotoc_md27"></a>
Fall through edges from call sites.</h2>
<p><a class="anchor" id="fall-through-edges-from-call-sites."></a></p>
<p>Since we're working with an interprocedural CFG, we have edges from call instructions to their targets. Do we also have edges from a call instruction to the instruction immediately after it in memory?</p>
<blockquote class="doxtable">
<p>Yes unless we know the callee does not return (e.g., exit). </p>
</blockquote>
<h3><a class="anchor" id="autotoc_md28"></a>
Non-return functions.</h3>
<p><a class="anchor" id="non-return-functions."></a></p>
<p>When generating code around non-return functions (like exit): sometimes compilers omit any following code if they know a call will not return. For example in a situation like this (except in machine code):</p>
<pre class="fragment">void foo()
{
    if (something) {
        bar_that_always_calls_exit();
        // stack cleanup
        return;
    }
}
</pre><p>In some cases, the compiler will know that <code>bar_that_always_calls_exit()</code> will never return. In some cases, the compiler doesn't figure that out. In the former case, the compiler may omit the "stack cleanup" and "return" code. In the latter case, it will not.</p>
<p>In some cases, your disassembly engine will know that <code>bar_that_always_calls_exit()</code> will never return. In some cases, your disassembly engine doesn't figure that out. In the former case, you can choose to omit the "fall-through" edge in your IR. In the latter case, you won't, because you think the execution flow is possible.</p>
<p>So, if you get the combination: the compiler figured it out and you did <em>not</em>. Then you will add the CFG edge from <code>bar_that_always_calls_exit()</code> to whatever follows. But whatever follows will not necessarily be code in the function <code>foo()</code> or code at all really. It will be whatever random chunk of bytes the compiler happened to plop down next.</p>
<p>We bring this up because it has bearing on your stance for adding edges from callsites to their follows. If you don't do that, you'll never make this mistake.</p>
<p>However, we suggest that in the balance, having the edges when your disassembly is correct outweighs the presence of this error.</p>
<h2><a class="anchor" id="autotoc_md29"></a>
Edges from returns back to call sites.</h2>
<p><a class="anchor" id="edges-from-returns-back-to-call-sites."></a></p>
<p>What about from a return instruction to corresponding call sites (plural) (or rather the instructions that follow them)?</p>
<blockquote class="doxtable">
<p>Yes. </p>
</blockquote>
<h2><a class="anchor" id="autotoc_md30"></a>
Edges from indirect calls to targets.</h2>
<p><a class="anchor" id="edges-from-indirect-calls-to-targets."></a></p>
<p>Indirect calls: we won't know who the targets are always. And we won't know to add edges from corresponding return instructions.</p>
<blockquote class="doxtable">
<p>We put in edges (to and from) as we're able to identify them. We don't conservatively put edges between every indirect call and every function. </p>
</blockquote>
<h2><a class="anchor" id="autotoc_md31"></a>
Tail calls.</h2>
<p><a class="anchor" id="tail-calls."></a></p>
<p>Tail calls don't have return instructions or a place for a callee to return to.</p>
<blockquote class="doxtable">
<p>Hook up the eventual return of a tail called function to the places it could lead (i.e., non tail-call callers and callers of tail-call callers). </p>
</blockquote>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
